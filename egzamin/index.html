<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Losowanie egzaminu INF.02</title>
    <link rel="stylesheet" href="egzamin/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <script src="egzamin/script.js" defer></script>
</head>
<body>
     <div class="nav-panel">
        <a href="https://www.kacpiq.pl/egzamin/lista-egzaminow" target="_blank">Lista egzaminów</a>
        
        <div class="dropdown">
            <a href="#" class="dropbtn">
                <i class="fas fa-arrow-down"></i>Pobierz
            </a>
            <div class="dropdown-content">

                <a href="#" id="download-windows">
                    <i class="fab fa-windows"></i>Pobierz na Windows
                    <div class="version-info">Wersja: N/A</div>
                    <div class="supported-systems">
                        Obsługiwane systemy: <span>Windows 7</span><span>Windows 10</span><span>Windows 11</span><span>(64bit)</span>
                    </div>
                    <div class="unavailable-info">Aplikacja jeszcze nie jest dostępna</div>
                    <div class="info">Planowane wydanie: 05.04.2025</div>
                </a>
                
                <a href="#" id="download-linux">
                    <i class="fab fa-linux"></i>Pobierz na Linux
                    <div class="version-info">Wersja: N/A</div>
                    <div class="supported-systems">
                        Obsługiwane systemy: <span>Ubuntu 18.04+</span><span>Debian 8+</span><span>Fedora 24+</span>
                    </div>
                    <div class="unavailable-info">Aplikacja jeszcze nie jest dostępna</div>
                </a>
                
                <a href="#" id="download-macos">
                    <i class="fab fa-apple"></i>Pobierz na MacOS
                    <div class="version-info">Wersja: N/A</div>
                    <div class="supported-systems">
                        Obsługiwane systemy: <span>macOS 10.11 (El Capitan)+</span><span>(64bit)</span>
                    </div>
                    <div class="unavailable-info">Aplikacja jeszcze nie jest dostępna</div>
                </a>
                <a href="#" id="download-exam">
                    <i class="fa-solid fa-download"></i>Pobierz arkusz
                    <div id="plik" class="version-info">Plik: Nie wylosowano egzaminu.</div>
                    <div class="supported-systems">
                        Rozszerzenie: <span>.pdf</span>
                    </div>
                </a>
            </div>
        </div>
         <a href="#" class="dropbtn">
                <i class="fas fa-trophy"></i>Ranking
            </a>

        <div id="przerwa-komunikat" class="przerwa-komunikat" style="display:none;">
            <p>Przerwa techniczna rozpocznie się 28.03.2025 o 18:30 i potrwa do 31.03.2025 14:30.<br> W tym czasie korzystanie ze strony i losowanie egzaminów będzie niedostępne.</p>
        </div>
    <div id="countdown">
        Do egzaminu pozostało: <span id="countdown-timer"></span>
    </div>
</div>
    </div>
    
    <div class="container">
        <h1 style:font-family: 'Reload';>Losowanie egzaminu INF.02</h1>

        <label>Podstawa programowa:</label>
        <select id="podstawa">
            <option value="">Wszystkie</option>
            <option value="2019">2019</option>
            <option value="2017">2017</option>
        </select>

        <label>System operacyjny serwera:</label>
        <select id="serwer">
            <option value="">Dowolny</option>
            <option value="Linux">Linux</option>
            <option value="Windows Server">Windows Server</option>
        </select>

        <label>System operacyjny klienta:</label>
        <select id="klient">
            <option value="">Dowolny</option>
            <option value="Windows">Windows</option>
            <option value="Linux">Linux</option>
        </select>

        <button id="losuj">Losuj egzamin</button>
         <div class="rating-info">
                        <span id="rating-value" style="font-weight:bold">⭐0,0 (0)</span><span id="exam-file-name"></span><span id="open-rating-modal" style="cursor: pointer;"><i class="fa-solid fa-star"></i></span>
                    </div>

        <div id="loading" style="display: none;">Ładowanie egzaminów...</div>

        <iframe id="examFrame" style="display: none;" width="100%" height="600px"></iframe>

        <button id="zakoncz" style="display: none;">Zakończ egzamin</button>
        <iframe id="keyFrame" style="display: none;" width="100%" height="300px"></iframe>
        <div id="rating-modal" class="rating-modal" style="display:none">
    <div class="modal-content">
    <span id="close-modal" class="close-modal">&times;</span>
    <h2>Oceń arkusz</h2>
    <div class="rating-container">
        <div class="rating-circle" data-value="1"><i class="fa-solid fa-star"></i></div>
        <div class="rating-circle" data-value="2"><i class="fa-solid fa-star"></i></div>
        <div class="rating-circle" data-value="3"><i class="fa-solid fa-star"></i></div>
        <div class="rating-circle" data-value="4"><i class="fa-solid fa-star"></i></div>
        <div class="rating-circle" data-value="5"><i class="fa-solid fa-star"></i></div>
    </div>
    <button id="submit-rating-modal">Zatwierdź ocenę</button>
</div>
</div>
    </div>
    <div class="popup" id="popup" onmouseover="expandPopup()" onmouseout="collapsePopup()" onclick="redirectToRevolut()">
        <img src="https://cdn.brandfetch.io/idkTaHd18D/w/400/h/400/theme/dark/icon.png?c=1dxbfHSJFAPEGdCLU4o5B" alt="R">
        <div class="popup-text" id="popupText">
            <div id="popupMessage">@kacpiq</div>
        </div>
    </div>
    <script>
        const messages = [
            "@kacpiq"
        ];
        let index = 0;
        let messageTimeout;
    
        function changeMessage() {
            const messageDiv = document.getElementById("popupMessage");
            messageDiv.style.opacity = 0;
    
            clearTimeout(messageTimeout);
    
            setTimeout(() => {
                if (index < messages.length) {
                    messageDiv.innerText = messages[index];
                    messageDiv.style.opacity = 1;
                    index++;
                } else {
                    messageDiv.innerText = '';
                }
            }, 500);
        }
    
        function expandPopup() {
            const popup = document.getElementById("popup");
            const popupText = document.getElementById("popupText");
    
            popup.classList.add("expanded");
            popupText.classList.add("visible");
    
            messageTimeout = setInterval(changeMessage, 3000);
        }
    
        function collapsePopup() {
            const popup = document.getElementById("popup");
            const popupText = document.getElementById("popupText");
    
            popup.classList.remove("expanded");
            popupText.classList.remove("visible");
    
            clearInterval(messageTimeout);
        }
    
        function redirectToRevolut() {
            window.open("https://revolut.me/kacpiq", "_blank");
        }

         function disableScript() {
            const script = document.getElementById("script");
            script.setAttribute("disabled", "true");
        }

        function checkTechnicalBreak() {
            const startDate = new Date('2025-03-28T18:30:00');
            const endDate = new Date('2025-03-31T14:30:00');
            const currentDate = new Date();

            if (currentDate >= startDate && currentDate <= endDate) {
                document.getElementById("przerwa-komunikat").style.display = 'block';

                document.getElementById("losuj").disabled = true;

                disableScript();
            }
        }


        window.onload = checkTechnicalBreak;
    </script>
<script>
    // Ustaw datę docelową
    var countDownDate = new Date("Jun 2, 2025 00:00:00").getTime();

    // Aktualizuj odliczanie co 1 sekundę
    var x = setInterval(function() {

        // Pobierz dzisiejszą datę i godzinę
        var now = new Date().getTime();
        
        // Oblicz różnicę czasu
        var distance = countDownDate - now;
        
        // Oblicz dni, godziny, minuty i sekundy
        var days = Math.floor(distance / (1000 * 60 * 60 * 24));
        var hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
        var seconds = Math.floor((distance % (1000 * 60)) / 1000);
        
        // Wyświetl wynik
        document.getElementById("countdown-timer").innerHTML = days + "d " + hours + "g " + minutes + "m " + seconds + "s";
        
        // Jeśli odliczanie się zakończy, wyświetl komunikat
        if (distance < 0) {
            clearInterval(x);
            document.getElementById("countdown-timer").innerHTML = "Egzamin rozpoczęty!";
        }
    }, 1000);
</script>
    <script type="module">
 import { initializeApp } from "https://www.gstatic.com/firebasejs/11.5.0/firebase-app.js";
        import { getDatabase, ref, push, query, orderByChild, onValue, equalTo, get, set , child} 
            from "https://www.gstatic.com/firebasejs/11.5.0/firebase-database.js";

        // Konfiguracja Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyDxweHC9eBj-1iZPtrgPBPngqSZGO0A_hY",
            authDomain: "kacpiq-egzamin.firebaseapp.com",
            databaseURL: "https://kacpiq-egzamin-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "kacpiq-egzamin",
            storageBucket: "kacpiq-egzamin.firebasestorage.app",
            messagingSenderId: "1060401996008",
            appId: "1:1060401996008:web:a382e44d487e8a079ae95d",
            measurementId: "G-KSJX5H1GFT"
        };

        // Inicjalizacja Firebase
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);


function sanitizeExamName(examName) {
    return examName.replace(/[.#$\[\]]/g, "_"); // Usuwamy niedozwolone znaki
}

// Funkcja pobierająca nazwę egzaminu (oryginalną nazwę, która jest wyświetlana)
function getExamName() {
    const examName = document.getElementById("exam-file-name").innerText;
    console.log("Nazwa egzaminu:", examName);  // Dodajemy log do konsoli
    return examName.trim(); // Zwracamy nazwę egzaminu bez dodatkowych spacji
}

    document.getElementById("losuj").addEventListener("click", function() {
        setTimeout(() => {
        loadCurrentRating();
    }, 2500);
});

function calculateAverage(ratings) {
    if (ratings && ratings.length > 0) {
        const total = ratings.reduce((sum, rating) => sum + rating, 0);
        return (total / ratings.length).toFixed(1); 
    }
    return 0.0; 
}

function loadCurrentRating() {
    const examName = getExamName(); // Pobieramy nazwę egzaminu
    const sanitizedExamName = sanitizeExamName(examName); // Sanityzacja nazwy egzaminu

    const ratingsRef = ref(db, 'exam-ratings/' + sanitizedExamName + '/ratings');
    get(ratingsRef).then((snapshot) => {
        if (snapshot.exists()) {
            const ratingsObject = snapshot.val(); // Pobieramy dane jako obiekt
            console.log("Pobrane oceny z Firebase:", ratingsObject);  // Dodajemy log do konsoli

            // Przekształcamy obiekt w tablicę ocen
            const ratings = Object.values(ratingsObject); // Przekształcamy wartości obiektu na tablicę
            console.log("Tablica ocen:", ratings); // Dodajemy log z tablicą ocen

            const averageRating = calculateAverage(ratings); // Obliczamy średnią ocenę
            const ratingCount = ratings.length; // Liczba ocen

            // Aktualizowanie wyświetlanej średniej oceny oraz liczby ocen
            document.getElementById("rating-value").innerHTML = `⭐${averageRating} (${ratingCount})`;
        } else {
            console.log("Brak ocen w Firebase.");  // Logujemy brak ocen
            document.getElementById("rating-value").innerText = "⭐0.0 (0)";
        }
    }).catch((error) => {
        console.error("Błąd pobierania ocen:", error);
    });
}

function saveRating() {
    if (selectedRating === 0) return;

    const examName = getExamName();
    if (!examName) return;

    const sanitizedExamName = sanitizeExamName(examName);
    const ratingsRef = ref(db, `exam-ratings/${sanitizedExamName}/ratings`);

    push(ratingsRef, selectedRating).then(() => {
        console.log("Ocena zapisana:", selectedRating);
        document.getElementById("rating-modal").style.display = "none";
        loadCurrentRating();
    }).catch(error => console.error("Błąd zapisu oceny:", error));
}

        document.getElementById("submit-rating-modal").addEventListener("click", saveRating);

let selectedRating = 0;
const circles = document.querySelectorAll(".rating-circle");

circles.forEach(circle => {
    circle.addEventListener("click", () => {
        const value = parseInt(circle.dataset.value);
        selectedRating = selectedRating === value ? 0 : value;
        updateSelection();
    });
});

function updateSelection() {
    circles.forEach(circle => {
        const value = parseInt(circle.dataset.value);
        circle.classList.toggle("selected", value <= selectedRating);
    });
}

document.getElementById("open-rating-modal").addEventListener("click", () => {
    document.getElementById("rating-modal").style.display = "flex";
});

document.getElementById("close-modal").addEventListener("click", () => {
    document.getElementById("rating-modal").style.display = "none";
});



// Załadowanie średniej oceny przy wczytywaniu strony
window.onload = () => {
    loadCurrentRating();
};
</script>
</body>
</html>
